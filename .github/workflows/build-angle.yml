name: Build ANGLE

on:
  workflow_dispatch:
    inputs:
      angle-branch:
        description: 'Git branch of ANGLE to build'
        required: true
        default: chromium/6793
      rendering-backend:
        description: 'Rendering backend to build'
        required: true
        type: choice
        options:
          - d3d9
          - d3d11
          - gl
          - metal
          - vulkan
          - essl
          - glsl
      upload-artifacts:
        description: 'Upload build artifacts to S3 storage'
        required: true
        type: boolean
        default: true
      s3-storage-endpoint:
        description: 'URL endpoint of the S3 storage.'
        required: true
        default: 'https://storage.byteplug.io'
      s3-bucket-name:
        description: 'Name of the S3 bucket'
        required: true
        default: 'intjelic'
      s3-path-prefix:
        description: 'Path prefix within the S3 bucket'
        default: '.'

jobs:
  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
        with:
          repository: google/angle
          ref: ${{ github.event.inputs['angle-branch'] }}
      - run: |
          ls .
          python scripts/bootstrap.py
          gclient sync
          gn gen out/Release
          cd out/Release
          ninja
